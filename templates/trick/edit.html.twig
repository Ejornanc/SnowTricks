{% extends "layouts/base.html.twig" %}

{% block title %}Modifier {{ trick.name }}{% endblock %}

{% block head %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('Css/Computer/EditTrick.css') }}">
{% endblock %}

{% block content %}
    <div class="trick-container">

        {# === Bannière === #}
        {% set bannerImage = null %}
        {% for image in trick.images %}
            {% if loop.first %}
                {% set bannerImage = asset('uploads/tricks/images/' ~ image.url) %}
            {% endif %}
        {% endfor %}

        {% if bannerImage is null %}
            {% set bannerImage = asset('Images/no_image_available.png') %}
        {% endif %}

        {{ form_start(form) }}

        <div class="trick-banner" style="background-image: url('{{ bannerImage }}')">
            <div class="trick-title-overlay">
                {{ form_row(form.name, {'label': false}) }}
            </div>
        </div>

        {# === Galerie images + vidéos === #}
        <div class="media-gallery">
            {% set hasImages = trick.images|length > 0 %}
            {% set hasVideos = trick.videos|length > 0 %}

            {# === Affichage des images === #}
            {% if hasImages %}
                {% for imageForm in form.images %}
                    <div class="media-item media-item-edit">
                        <img src="{{ asset('uploads/tricks/images/' ~ trick.images[loop.index0].url) }}" alt="Image du trick">

                        <div class="media-actions">
                            <button type="button" class="edit-media-button" data-target="#image-field-{{ loop.index0 }}" title="Modifier">
                                <!-- icône crayon -->
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="black" viewBox="0 0 24 24">
                                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1.003 1.003 0 0 0 0-1.41l-2.34-2.34a1.003 1.003 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"></path>
                                </svg>
                            </button>

                            <button type="button" class="delete-media-button" title="Supprimer">
                                <!-- icône poubelle -->
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="black" viewBox="0 0 24 24">
                                    <path d="M3 6h18v2H3V6zm2 3h14v13H5V9zm5 2v9h2v-9H10zm4 0v9h2v-9h-2z"></path>
                                </svg>
                            </button>
                        </div>

                        {{ form_row(imageForm, { 'attr': { 'style': 'display: none;', 'id': 'image-field-' ~ loop.index0 } }) }}
                    </div>
                {% endfor %}
            {% else %}
                <div class="media-item">
                    <img src="{{ asset('Images/no_image_available.png') }}" alt="Aucune image disponible">
                </div>
            {% endif %}

            {# === Affichage des vidéos === #}
            {% if hasVideos %}
                {% for videoForm in form.videos %}
                    <div class="media-item media-item-edit">
                        <iframe src="{{ trick.videos[loop.index0].url }}" allowfullscreen></iframe>

                        <div class="media-actions">
                            <button type="button" class="edit-media-button" data-target="#video-field-{{ loop.index0 }}" title="Modifier">
                                <!-- icône crayon -->
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="black" viewBox="0 0 24 24">
                                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1.003 1.003 0 0 0 0-1.41l-2.34-2.34a1.003 1.003 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"></path>
                                </svg>
                            </button>

                            <button type="button" class="delete-media-button" title="Supprimer">
                                <!-- icône poubelle -->
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="black" viewBox="0 0 24 24">
                                    <path d="M3 6h18v2H3V6zm2 3h14v13H5V9zm5 2v9h2v-9H10zm4 0v9h2v-9h-2z"></path>
                                </svg>
                            </button>
                        </div>

                        {{ form_row(videoForm, { 'attr': { 'style': 'display: none;', 'id': 'video-field-' ~ loop.index0 } }) }}
                    </div>
                {% endfor %}
            {% else %}
                <div class="media-item">
                    <img src="{{ asset('Images/no_video_available.png') }}" alt="Aucune vidéo disponible">
                </div>
            {% endif %}
        </div>

        {# === Description et metadata === #}
        <section class="trick-description">
            <div class="description-content">
                <h2>Description</h2>
                {{ form_row(form.description) }}
            </div>

            <div class="trick-metadata">
                {{ form_row(form.trickType) }}
                {{ form_row(form.difficulty) }}
            </div>
        </section>

        <div class="form-actions">
            <button type="submit">Enregistrer les modifications</button>
            <a href="{{ path('trick_show', { slug: trick.slug }) }}" class="cancel-button">Annuler</a>
        </div>

        {{ form_end(form) }}
    </div>

    <script src="{{ asset('js/EditTrick.js') }}"></script>
{% endblock %}
